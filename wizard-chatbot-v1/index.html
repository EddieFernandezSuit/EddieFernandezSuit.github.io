<!DOCTYPE html>
<html lang="en">

<!-- python -m http.server 3000 -->
<head>
    <title>Wizard Room</title>
    <link rel="stylesheet" href="wizardRoom.css" />
</head>

<body>
    
    <img id="scroll" src="textBoxScroll.png" alt="scroll" >
    <div id="ChatContainer" >
        <div>
            <span class="ChatText">
                Chat:
            </span>
            <input type="text" id="ChatInput" class="ChatText" size="30">
        </div>
        <p id="textHistory" class="ChatText">
            <!-- Wizard: Hello -->
        </p>
    </div>
    
    <div id="WebGLOutput"></div>

    <section id="loadingScreen">
        <div id="loader"></div>
    </section>
    
    <script type="module" src="3dRoom.js"></script>
    <script type="module">
        
        import { request } from "https://cdn.pika.dev/@octokit/request";

        var chat = document.getElementById("ChatInput");
        var textHistory = document.getElementById("textHistory");

        chat.addEventListener('keypress', (e)=>{
        if(e.key === 'Enter'){
            var input = document.getElementById("ChatInput").value;
            var currentChat = document.getElementById("textHistory").innerHTML;
            query({"data": {"inputs":{"text": "who are you?"} }}).then((response) => {
                console.log(response[0]["generated_text"]);
                console.log(JSON.stringify(response));
                
                document.getElementById("textHistory").innerHTML = currentChat + "<br />" + "Adventurer: " + input + "<br />" + "Wizard: " + response[0]["generated_text"];
                document.getElementById("ChatInput").value = "";
                document.getElementById("textHistory").scroll();
            });
        }
        })

        document.addEventListener("keyup", function(event){
        if(event.which === 13){
            document.getElementById("ChatInput").focus();
        }
        })

        async function query(data) {
            const response = await fetch(
                'https://maa63b24v2.execute-api.us-east-1.amazonaws.com/Stage/wizard-conversation',
                {
                    headers: { 'x-api-key': 'V1ntJhN1JQ1cGzdUpg5nK9oFMDJ4YZWy1uqge2AL',
                    'Content-Type': 'application/json'},
                    method: 'POST',
                    mode:"no-cors",
                    body: JSON.stringify(data),
                }
            );
            const result = await response.json();
            return result;
        }

    </script>

</body>

</html>